apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: masternginx
  namespace: argocd
spec:
  generators:
  - list:
      elements:
      - cluster: dev
        url: https://kubernetes.default.svc
#        image: nginx:1.14.2
#        port: "80"
        image:
          repoURL: https://github.com/unique-tensai/sample-mavenapp2.git
          path: src/main/webapp
          deploymentName: sample-app
          namespace: sample-app
          serviceEnabled: true
          serviceType: LoadBalancer
          servicePort: 8080
      - cluster: prod
        url: https://aks197-dns-507c5200.hcp.centralus.azmk8s.io:443
#        image: nginx:1.21.1
#        port: "8080"
        image:
          repoURL: https://github.com/unique-tensai/sample-mavenapp2.git
          path: src/main/webapp
          deploymentName: sample-app
          namespace: sample-app
          serviceEnabled: true
          serviceType: LoadBalancer
          servicePort: 8080
  template:
    metadata:
      name: '{{cluster}}-appsets'
    spec:
      project: default
      source:
        repoURL: https://github.com/tensai-for-release/argocd.git
        targetRevision: HEAD
        path: applicationsets
#        helm:
#          releaseName: '{{image}}-nginx'
#          parameters:
#          - name: image
#            value: '{{image}}'
#          - name: port
#            value: '{{port}}'  
      destination:
        server: '{{url}}'
 #       namespace: argocd
      syncPolicy:
        automated: {}
